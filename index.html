<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Global Carnivore Coaches | Durability. Focus. Freedom.</title>
  <link rel="icon" type="image/png" href="images/earth_steak.png">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* === ALL YOUR ORIGINAL CSS FROM index.html (unchanged) === */
    /* Paste the entire <style> block from your original index.html here */
    /* I’m skipping it here for brevity — keep 100% identical */
  </style>
</head>
<body>
  <!-- Your full nav, hero, sections, etc. — unchanged until modals -->
  <!-- ... everything up to the gallery ... -->

  <!-- Meal Ideas Gallery (only tiles — modals now loaded dynamically) -->
  <section class="card" id="mealideas">
    <h2 id="cache-title">Shared Meal Ideas <span class="subline">Inspiration for sustained performance</span></h2>
    <p class="lead">Click any image to open a larger view.</p>
    <div class="gallery" id="mealGallery">
      <!-- JS will populate tiles + inject lightbox modals -->
    </div>
  </section>

  <!-- Placeholder for all modals (image + coach) -->
  <div id="modalsContainer"></div>

  <!-- Shared modal JS -->
  <script src="js/modals.js"></script>

  <script>
    const API_BASE_URL = window.location.protocol === 'https:' ? `https://${location.hostname}:477/webapi` : `http://${location.hostname}:8080/webapi`;

    const mealImages = [
      {src: "images/meatzza.jpg", alt: "Meatzza Bomb", caption: "Meatzza Bomb"},
      {src: "images/image004.jpg", alt: "Slow-forged beef haunches", caption: "Beef Haunches"},
      // ... add all your images here
      {src: "images/image010.jpg", alt: "Brisket Plate", caption: "Brisket Plate"}
    ];

    // Inject meal lightbox modals
    function loadMealModals() {
      const container = document.getElementById('modalsContainer');
      const gallery = document.getElementById('mealGallery');
      mealImages.forEach((img, i) => {
        const id = `img-meal-${i}`;
        // Tile
        const tile = document.createElement('a');
        tile.className = 'tile';
        tile.href = `#${id}`;
        tile.innerHTML = `<img src="${img.src}" alt="${img.alt}" loading="lazy"><div class="caption">${img.caption}</div>`;
        tile.querySelector('img').addEventListener('load', () => tile.classList.add('loaded'), {once: true});
        gallery.appendChild(tile);

        // Modal
        fetch('components/modal-image.html')
          .then(r => r.text())
          .then(html => {
            const modalHtml = html
              .replace('{{id}}', id)
              .replace('{{src}}', img.src)
              .replace('{{alt}}', img.alt);
            container.insertAdjacentHTML('beforeend', modalHtml);
          });
      });
    }

    // Load coaches + their modals (same as before, but using reusable template)
    async function loadCoaches() {
      try {
        const res = await fetch('/webapi/get_coaches.php');
        const data = await res.json();
        if (!data.success) return;

        const gallery = document.createElement('div');
        gallery.className = 'gallery';
        gallery.id = 'coachGallery';
        document.querySelector('#community .card')?.appendChild(gallery); // adjust selector if needed

        for (const coach of data.coaches) {
          const username = coach.Username.toLowerCase();
          const name = coach.CoachName || coach.Username;
          const bio = (coach.Bio || '').split(/\r?\n\r?\n/).map(p => `<p>${p.trim()}</p>`).join('');
          const files = coach.Files || {};
          const profile = files.Profile ? `/webapi/${files.Profile}` : 'images/WolfCoach_Profile.png';
          const before = files.Before ? `/webapi/${files.Before}` : null;
          const after = files.After ? `/webapi/${files.After}` : profile;
          const cert = files.Certificate ? `/webapi/${files.Certificate}` : 'images/toon_cert.jpg';

          // Tile
          const tile = document.createElement('a');
          tile.className = 'tile';
          tile.href = `#coach-${username}`;
          tile.innerHTML = `
            <img src="${profile}" alt="${name}" loading="lazy">
            <div class="caption">${name}</div>
          `;
          tile.querySelector('img').addEventListener('load', () => tile.classList.add('loaded'), {once: true});
          gallery.appendChild(tile);

          // Photos HTML
          let photosHtml = '';
          if (before || after) {
            photosHtml = `<div class="photo-container">
              ${before ? `<img src="${before}" alt="${name} before" class="photo-old">` : ''}
              <img src="${after}" alt="${name} after" class="photo-new">
            </div>`;
          }

          // Load reusable coach modal
          fetch('components/modal-coach.html')
            .then(r => r.text())
            .then(html => {
              const modalHtml = html
                .replace(/{{username}}/g, username)
                .replace('{{name}}', name)
                .replace('{{bio}}', bio || '<p>No bio yet.</p>')
                .replace('{{cert}}', cert)
                .replace('{{photos}}', photosHtml);
              document.getElementById('modalsContainer').insertAdjacentHTML('beforeend', modalHtml);
            });
        }
      } catch (err) { console.error(err); }
    }

    loadMealModals();
    loadCoaches();
  </script>
</body>
</html>