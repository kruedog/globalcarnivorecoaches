<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Global Carnivore Coaches | Durability. Focus. Freedom.</title>
  <link rel="icon" type="image/png" href="images/earth_steak.png">

  <!-- Global CSS -->
  <link rel="stylesheet" href="css/global.css" />
</head>

<script>
fetch('/webapi/track_visit.php', {
  method: 'GET',
  cache: 'no-store'
});
</script>

<body>
  <!-- NAV Section -->
  <nav class="top-nav" aria-label="Main Navigation">
    <div class="wrap nav-inner" style="padding:0;">
      <div class="nav-left">
        <a class="brand-mini" href="#about" aria-label="Global Carnivore Coaches home">
          <img src="images/earth_steak.png" alt="Global Carnivore Coaches logo" onerror="this.style.display='none'">
          <span>Global Carnivore Coaches</span>
        </a>
      </div>
      <div class="nav-right" role="navigation" aria-label="Site links">
        <a href="#services" class="nav-link">Programs</a>
        <a href="#about" class="nav-link">About</a>
        <a href="science.html" class="nav-link">Science</a>
        <a href="#mealideas" class="nav-link">Gallery</a>
        <a href="#contact" class="nav-link">Contact</a>
        <a href="webapi/login.html" class="nav-link">Coach Login</a>
      </div>
    </div>
  </nav>

  <main class="wrap" id="maincontent">

    <!-- HERO Section -->
    <header class="hero" role="banner" aria-labelledby="hero-title">
      <div class="hero-left" aria-hidden="true">
        <div class="logo">
          <img src="images/earth_steak.png" alt="Planet Earth and Ribeye Steak">
        </div>
      </div>
      <div>
        <h1 id="hero-title">Global Carnivore Coaches</h1>
        <p class="tag">Eat a primal Diet. Feel like a primal Human.</p>
        <p class="lead-hero">
          Active enrollment — straightforward, evidence-minded carnivore coaching for durability, focus, and long-range endurance.
        </p>
      </div>
    </header>

    <!-- SERVICES Section -->
    <section class="card" id="services" aria-labelledby="services-title">
      <div class="cols">
        <div>
          <h2 id="services-title">
            Core Programs: Transformation Blueprint
            <span class="subline">Unleash • Optimize • Thrive</span>
          </h2>
          <p class="lead">
            Reclaim your vitality …
          </p>
        </div>
        <aside class="card-aside" aria-labelledby="mission-title">
          <div id="mission-title">Mission Focus</div>
          <ul>
            <li>System Reset — gut & digestion</li>
            <li>Inflammation mitigation</li>
            <li>Metabolic optimization</li>
            <li>Energy & focus restoration</li>
            <li>Personalized accountability</li>
          </ul>
        </aside>
      </div>
    </section>

    <div class="divider"></div>

    <!-- COACHES Section -->
    <section class="card" id="about">
      <h2>
        Meet the Coaches
        <span class="subline">Certified. Battle-Tested. Yours.</span>
      </h2>
      <p class="lead">These coaches have walked the carnivore path.</p>

      <div class="cols">
        <div class="gallery" id="coachGallery"></div>
        <aside class="card-aside">
          <h3>How It Works</h3>
          <ol>
            <li>Discovery call</li>
            <li>Custom blueprint</li>
            <li>Track wins weekly</li>
            <li>Thrive for life</li>
          </ol>
        </aside>
      </div>
    </section>

    <div class="divider"></div>

    <!-- Shared Meal Ideas -->
    <section class="card" id="mealideas">
      <h2>
        Shared Meal Ideas
        <span class="subline">Inspiration for sustained performance</span>
      </h2>

      <div style="width:100%;height:520px;overflow:hidden;border-radius:8px;">
        <iframe src="mealideas.html" title="Shared Meal Ideas Gallery"
        style="width:100%;height:100%;border:none;"></iframe>
      </div>
    </section>

    <div class="divider"></div>

    <!-- Modal -->
    <div id="publicProfileModal" class="modal">
      <div class="modal-shell">
        <button class="modal-close" id="closeModal">&times;</button>

        <div class="modal-header">
          <h2 id="modalName">Coach Name</h2>
          <p><a id="modalEmail"></a></p>
          <div class="profile-avatar">
            <img id="modalProfilePic" src="images/earth_steak.png" alt="">
          </div>
        </div>

        <div class="modal-body">
          <div>
            <div class="bio-box" id="modalBio"></div>
            <div class="before-after" id="beforeAfterContainer"></div>
          </div>
          <div>
            <div class="specialization-box">
              <h3>I Specialize In</h3>
              <ul id="specList"></ul>
            </div>
            <div id="certificateContainer"></div>
          </div>
        </div>

        <button class="book-btn" id="bookCoach">Book This Coach</button>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Global Carnivore Coaches. All rights reserved.</p>
  </footer>

<script>
const COACHES_JSON_URL = "https://globalcarnivorecoaches.onrender.com/uploads/coaches.json";
const DASHBOARD_API = window.location.origin + '/webapi/dashboard';
let currentCoach = null;  // <-- NEW global reference

async function logProfileView(username) {
  try {
    await fetch(`${DASHBOARD_API}/log_profile_view.php`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      credentials: 'include',
      body: JSON.stringify({coach: username})
    });
  } catch(e) {
    console.warn("Profile view not logged:", e);
  }
}

function fixPath(p){ … }  /* unchanged */
function getSpecs(raw){ … } /* unchanged */

async function loadCoaches() {
  try {
    const res = await fetch(COACHES_JSON_URL,{cache:"no-store"});
    const data = await res.json();
    const gallery = document.getElementById("coachGallery");
    gallery.innerHTML = "";
    data.forEach(coach=>{
      const files = coach.Files || {};
      const profileImg = fixPath(files.Profile) || "images/WolfCoach_Profile.png";
      const card = document.createElement("div");
      card.className = "coach-card";
      card.innerHTML = `
        <a href="#" class="tile coach-tile"><img src="${profileImg}"></a>
        <button class="view-btn">View Profile</button>
      `;
      const open = evt=>{evt.preventDefault(); openCoachModal(coach);};
      card.querySelector(".coach-tile").onclick = open;
      card.querySelector(".view-btn").onclick = open;
      gallery.appendChild(card);
    });
  } catch(err){ console.error(err); }
}

function openCoachModal(coach) {
  currentCoach = coach; // <-- NEW: track who is opened

  // NEW: log view once user opens modal
  const uname = coach.Username || coach.CoachName;
  if (uname) logProfileView(uname);

  const files = coach.Files || {};
  document.getElementById("modalName").textContent =
    coach.CoachName || coach.Username || "Coach";
  …
  document.getElementById("publicProfileModal").classList.add("show");
}

document.getElementById("closeModal").onclick = () =>
  document.getElementById("publicProfileModal").classList.remove("show");

document.addEventListener("keydown",e=>{
  if(e.key==="Escape")
    document.getElementById("publicProfileModal").classList.remove("show");
});

document.getElementById("publicProfileModal").onclick = e=>{
  if(e.target===e.currentTarget)
    e.currentTarget.classList.remove("show");
};

document.readyState==="loading"
  ? document.addEventListener("DOMContentLoaded", loadCoaches)
  : loadCoaches();
</script>

</body>
</html>
