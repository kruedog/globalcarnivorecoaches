<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Coach Login • Global Carnivore Coaches</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/png" href="/images/earth_steak.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --blue:#192168;
  --red:#AF1E2D;
  --bg:#f3f5fa;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  min-height:100vh;
  font-family:'Inter',sans-serif;
  background:radial-gradient(circle at 10% 10%,#F8F9FA 0%,#D0D2D5 40%,#B0B3BA 100%);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:1.5rem;
}
.card{
  background:#fff;
  border-radius:18px;
  max-width:420px;
  width:100%;
  padding:2.4rem 2.2rem;
  box-shadow:0 18px 50px rgba(0,0,0,.2);
  border:2px solid rgba(25,33,104,.25);
}
h1{
  font-family:'Cinzel',serif;
  font-size:1.9rem;
  color:var(--blue);
  margin-bottom:.4rem;
  text-align:center;
}
p.lead{
  font-size:.9rem;
  color:#555;
  text-align:center;
  margin-bottom:1.5rem;
}
label{
  display:block;
  margin:.6rem 0 .2rem;
  font-weight:600;
  font-size:.9rem;
  color:var(--blue);
}
input{
  width:100%;
  padding:.7rem .85rem;
  border-radius:10px;
  border:2px solid #c4c7d3;
  font-size:.95rem;
  font-family:inherit;
}
input:focus{
  outline:none;
  border-color:var(--red);
  box-shadow:0 0 0 3px rgba(175,30,45,.2);
}
.btn{
  width:100%;
  margin-top:1.3rem;
  padding:.9rem 1rem;
  border-radius:999px;
  border:none;
  font-weight:700;
  font-size:.98rem;
  cursor:pointer;
  background:linear-gradient(180deg,var(--red),#8b1624);
  color:#fff;
  box-shadow:0 14px 36px rgba(175,30,45,.5);
}
.btn:hover{
  transform:translateY(-1px);
}
.status{
  margin-top:.7rem;
  font-size:.85rem;
  min-height:1rem;
  text-align:center;
}
.status.ok{color:green}
.status.err{color:var(--red)}
.small-link{
  margin-top:1.3rem;
  text-align:center;
  font-size:.85rem;
}
.small-link a{
  color:var(--blue);
  text-decoration:underline;
}
.logo-wrap{
  display:flex;
  justify-content:center;
  margin-bottom:1rem;
}
.logo-wrap img{
  width:70px;
  height:70px;
  border-radius:16px;
  border:3px solid var(--red);
  box-shadow:0 10px 28px rgba(0,0,0,.55);
}
</style>
</head>
<body>
<div class="card">
  <div class="logo-wrap">
    <img src="/images/earth_steak.png" alt="Global Carnivore Coaches">
  </div>
  <h1>Coach Login</h1>
  <p class="lead">Access your profile, update your public page, and track visitors.</p>

  <form id="loginForm" autocomplete="on">
    <label for="username">Username</label>
    <input id="username" name="username" autocomplete="username" required>

    <label for="password">Password</label>
    <input id="password" name="password" type="password" autocomplete="current-password" required>

    <button type="submit" class="btn">Login</button>
    <div id="status" class="status"></div>
  </form>

  <div class="small-link">
    <a href="/">← Back to homepage</a>
  </div>
</div>

<script>
const API_BASE = window.location.origin + '/webapi/';

const form   = document.getElementById('loginForm');
const statusEl = document.getElementById('status');

function setStatus(msg, ok = true) {
  statusEl.textContent = msg || '';
  statusEl.className = 'status ' + (msg ? (ok ? 'ok' : 'err') : '');
}

// Check session on load: if already logged in, go to profile
async function checkSession() {
  try {
    const res = await fetch(API_BASE + 'login.php', {
      method: 'GET',
      credentials: 'include',
      cache: 'no-store'
    });
    const data = await res.json();
    if (data && data.success) {
      window.location.href = '/profile.html';
    }
  } catch (err) {
    // silent fail; user just stays on login
    console.warn('Session check failed', err);
  }
}

async function handleLogin(e) {
  e.preventDefault();
  setStatus('Logging in…', true);

  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;

  if (!username || !password) {
    setStatus('Please enter both username and password.', false);
    return;
  }

  try {
    const res = await fetch(API_BASE + 'login.php', {
      method: 'POST',
      credentials: 'include',
      cache: 'no-store',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ username, password })
    });

    let data;
    try {
      data = await res.json();
    } catch (parseErr) {
      console.error('Parse error:', parseErr);
      setStatus('Server returned invalid response.', false);
      return;
    }

    if (!data.success) {
      setStatus(data.message || 'Login failed.', false);
      return;
    }

    // Success
    setStatus('Login successful. Redirecting…', true);
    window.location.href = '/profile.html';

  } catch (err) {
    console.error(err);
    setStatus('Network error during login.', false);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  checkSession();
  form.addEventListener('submit', handleLogin);
});
</script>
</body>
</html>
