<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Coach Login • Global Carnivore Coaches</title>

<link rel="icon" type="image/png" href="/images/earth_steak.png">
<link rel="stylesheet" href="/css/global.css">

<style>
body {
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at 10% 10%,#F8F9FA 0%,var(--parch) 45%,#B0B3BA 100%);
}
.login-card {
  background:rgba(255,255,255,.75);
  backdrop-filter:blur(14px);
  box-shadow:0 18px 60px rgba(0,0,0,.25);
  border-radius:18px;
  padding:2rem;
  width:100%;
  max-width:450px;
  border:3px solid var(--blue);
  text-align:center;
}
h1 {
  font-family:'Cinzel',serif;
  color:var(--blue);
  font-size:2rem;
  margin-bottom:.25rem;
}
.sub {
  font-size:.95rem;
  color:var(--muted);
  margin-bottom:1.6rem;
}
input {
  width:100%;
  padding:.9rem 1.1rem;
  font-size:1rem;
  border:2px solid var(--blue);
  border-radius:12px;
  margin-bottom:1rem;
}
input:focus {
  border-color:var(--red);
  outline:none;
  box-shadow:0 0 0 4px rgba(175,30,45,.15);
}
button {
  width:100%;
  background:var(--red);
  color:#fff;
  padding:.9rem;
  border:none;
  font-weight:800;
  border-radius:999px;
  font-size:1.05rem;
  cursor:pointer;
  transition:.25s;
}
button:hover {
  background:#8b1624;
}
small {
  display:block;
  margin-top:1rem;
}
.error-msg {
  color:var(--red);
  font-weight:700;
  margin-bottom:.75rem;
  min-height:1rem;
}
</style>
</head>

<body>

<div class="login-card">
  <img src="/images/earth_steak.png" alt="" style="width:95px;margin-bottom:1rem;">
  <h1>Coach Login</h1>
  <p class="sub">Welcome back — access your private dashboard</p>

  <div id="err" class="error-msg"></div>

  <form id="loginForm" autocomplete="on">
    <input id="username" name="username" required placeholder="Username" autocomplete="username">

    <input id="password" name="password" required type="password"
           placeholder="Password" autocomplete="current-password">

    <button type="submit" id="loginBtn">Sign In</button>
  </form>

  <small>Forgot password? Contact admin.</small>
</div>

<script>
const API_URL = location.origin + "/webapi/login.php";

// If already logged in, skip login page
if (localStorage.getItem("username")) {
  window.location.href = "/webapi/profile.html";
}

document.getElementById("loginForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const errBox = document.getElementById("err");
  errBox.textContent = "";

  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value;

  if (!username || !password) {
    errBox.textContent = "Enter username & password.";
    return;
  }

  try {
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({username, password})
    });

    const data = await res.json();
    console.log("LOGIN API RESPONSE:", data);

    if (!data.success) {
      errBox.textContent = data.message || "Login failed.";
      return;
    }

    // Save correct fields from backend
    localStorage.setItem("username", data.Username);
    localStorage.setItem("role", data.role);

    console.log("LOGIN STORED:", {
      username: data.Username,
      role: data.role
    });

    // Redirect after successful login
    window.location.href = "/webapi/profile.html";
  }
  catch (err) {
    console.error(err);
    errBox.textContent = "Server unreachable — try again.";
  }
});
</script>

</body>
</html>
