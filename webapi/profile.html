<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Coach Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lora&display=swap" rel="stylesheet">

<style>
  body {
    font-family:'Lora',serif;
    background:#f4f4f4;
    margin:0;
    padding:20px;
    color:#192168;
  }
  .container {
    max-width:850px;
    margin:auto;
    background:#fff;
    padding:30px;
    border-radius:16px;
    box-shadow:0 4px 14px rgba(0,0,0,0.15);
  }
  h1 { font-family:'Cinzel',serif; margin-bottom:20px; color:#C51230; }
  label { display:block; margin-top:1rem; font-weight:bold; }
  input,textarea {
    width:100%;
    padding:.5rem;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:1rem;
    margin-top:.3rem;
  }
  textarea { height:120px; }
  button {
    margin-top:20px;
    padding:12px 24px;
    background:#AF1E2D;
    color:#fff;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:1rem;
  }
  .profile-img {
    width:160px;
    height:160px;
    object-fit:cover;
    border-radius:12px;
    border:2px solid #C51230;
    margin-bottom:10px;
  }
</style>
</head>

<body>
<div class="container">
  <h1>My Profile</h1>

  <!-- Profile Image -->
  <label>Profile Image</label>
  <img id="profilePreview" class="profile-img" src="" alt="Profile Image">
  <input type="file" id="profileImg">

  <!-- Profile Fields -->
  <label>Username</label>
  <input type="text" id="username" readonly>

  <label>Coach Name</label>
  <input type="text" id="coachName">

  <label>Email</label>
  <input type="email" id="email">

  <label>Bio</label>
  <textarea id="bio"></textarea>

  <label>Certifications</label>
  <textarea id="certifications"></textarea>

  <label>Specialties (comma separated)</label>
  <input type="text" id="specializations">

  <button type="button" id="saveBtn">Save Changes</button>
</div>


<script>
const API_BASE = ''; // same folder, no full URL needed

// Load data from coaches.json
async function loadProfile() {
  const res = await fetch('/get_coach.php?username=thor');
  const data = await res.json();
  if (!data.success) return;

  const coach = data.coach;

  document.getElementById('username').value = coach.Username || '';
  document.getElementById('coachName').value = coach.CoachName || '';
  document.getElementById('email').value = coach.Email || '';
  document.getElementById('bio').value = coach.Bio || '';
  document.getElementById('certifications').value = coach.Certifications || '';
  document.getElementById('specializations').value = Array.isArray(coach.Specialties)
    ? coach.Specialties.join(', ')
    : '';

  if (coach.ProfileImage) {
    document.getElementById('profilePreview').src = '/data/uploads/' + coach.ProfileImage;
  } else {
    document.getElementById('profilePreview').src = '/images/user_default.png';
  }
}

loadProfile();

// Save Profile Handler
document.getElementById('saveBtn').onclick = async () => {
  const formData = new FormData();
  formData.append('username', document.getElementById('username').value);
  formData.append('CoachName', document.getElementById('coachName').value);
  formData.append('Email', document.getElementById('email').value);
  formData.append('Bio', document.getElementById('bio').value);
  formData.append('Certifications', document.getElementById('certifications').value);

  // Specialties as JSON array
  const specs = document.getElementById('specializations').value
    .split(',')
    .map(s => s.trim())
    .filter(s => s.length > 0);
  formData.append('Specialties', JSON.stringify(specs));

  const imgInput = document.getElementById('profileImg');
  if (imgInput.files.length > 0) {
    formData.append('ProfileImage', imgInput.files[0]);
  }

  try {
    const res = await fetch('/update_coach.php', {
      method: 'POST',
      body: formData
    });

    const data = await res.json();
    console.log(data);

    if (!data.success) {
      alert('Save failed: ' + (data.message || 'Unknown error'));
      return;
    }

    alert('Profile updated!');
    loadProfile(); // refresh UI without reloading page
  } catch (err) {
    console.error(err);
    alert('Error saving profile.');
  }
};
</script>

</body>
</html>
